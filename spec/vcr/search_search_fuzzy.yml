---
http_interactions:
- request:
    method: get
    uri: http://localhost:9200/sections/_search?size=1000000
    body:
      encoding: UTF-8
      string: ! "{\n  \"query\": {\n    \"constant_score\": {\n      \"filter\": {\n
        \       \"and\": [\n          {\n            \"query\": {\n              \"query_string\":
        {\n                \"query\": \"horse\",\n                \"fields\": [\n
        \                 \"description\"\n                ],\n                \"query_string\":
        {\n                  \"fields\": [\n                    \"title\"\n                  ]\n
        \               }\n              }\n            }\n          },\n          {\n
        \           \"or\": [\n              {\n                \"and\": [\n                  {\n
        \                   \"range\": {\n                      \"validity_end_date\":
        {\n                        \"gte\": \"<%= Date.today %>\"\n                      }\n
        \                   }\n                  }\n                ]\n              },\n
        \             {\n                \"and\": [\n                  {\n                    \"range\":
        {\n                      \"validity_start_date\": {\n                        \"lte\":
        \"<%= Date.today %>\"\n                      }\n                    }\n                  },\n
        \                 {\n                    \"missing\": {\n                      \"field\":
        \"validity_end_date\",\n                      \"null_value\": true,\n                      \"existence\":
        true\n                    }\n                  }\n                ]\n              }\n
        \           ]\n          }\n        ]\n      }\n    }\n  }\n}"
    headers:
      Accept:
      - ! '*/*; q=0.5, application/xml'
      Accept-Encoding:
      - gzip, deflate
      Content-Length:
      - '1309'
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Content-Type:
      - application/json; charset=UTF-8
      Content-Length:
      - '123'
    body:
      encoding: US-ASCII
      string: ! '{"took":31,"timed_out":false,"_shards":{"total":5,"successful":5,"failed":0},"hits":{"total":0,"max_score":null,"hits":[]}}'
    http_version:
  recorded_at: Thu, 27 Jun 2013 13:20:06 GMT
- request:
    method: get
    uri: http://localhost:9200/chapters/_search?size=1000000
    body:
      encoding: UTF-8
      string: ! "{\n  \"query\": {\n    \"constant_score\": {\n      \"filter\": {\n
        \       \"and\": [\n          {\n            \"query\": {\n              \"query_string\":
        {\n                \"query\": \"horse\",\n                \"fields\": [\n
        \                 \"description\"\n                ]\n              }\n            }\n
        \         },\n          {\n            \"or\": [\n              {\n                \"and\":
        [\n                  {\n                    \"range\": {\n                      \"validity_end_date\":
        {\n                        \"gte\": \"<%= Date.today %>\"\n                      }\n
        \                   }\n                  }\n                ]\n              },\n
        \             {\n                \"and\": [\n                  {\n                    \"range\":
        {\n                      \"validity_start_date\": {\n                        \"lte\":
        \"<%= Date.today %>\"\n                      }\n                    }\n                  },\n
        \                 {\n                    \"missing\": {\n                      \"field\":
        \"validity_end_date\",\n                      \"null_value\": true,\n                      \"existence\":
        true\n                    }\n                  }\n                ]\n              }\n
        \           ]\n          }\n        ]\n      }\n    }\n  }\n}"
    headers:
      Accept:
      - ! '*/*; q=0.5, application/xml'
      Accept-Encoding:
      - gzip, deflate
      Content-Length:
      - '1178'
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Content-Type:
      - application/json; charset=UTF-8
      Content-Length:
      - '123'
    body:
      encoding: US-ASCII
      string: ! '{"took":28,"timed_out":false,"_shards":{"total":5,"successful":5,"failed":0},"hits":{"total":0,"max_score":null,"hits":[]}}'
    http_version:
  recorded_at: Thu, 27 Jun 2013 13:20:06 GMT
- request:
    method: get
    uri: http://localhost:9200/headings/_search?size=1000000
    body:
      encoding: UTF-8
      string: ! "{\n  \"query\": {\n    \"constant_score\": {\n      \"filter\": {\n
        \       \"and\": [\n          {\n            \"query\": {\n              \"query_string\":
        {\n                \"query\": \"horse\",\n                \"fields\": [\n
        \                 \"description\"\n                ]\n              }\n            }\n
        \         },\n          {\n            \"or\": [\n              {\n                \"and\":
        [\n                  {\n                    \"range\": {\n                      \"validity_end_date\":
        {\n                        \"gte\": \"<%= Date.today %>\"\n                      }\n
        \                   }\n                  }\n                ]\n              },\n
        \             {\n                \"and\": [\n                  {\n                    \"range\":
        {\n                      \"validity_start_date\": {\n                        \"lte\":
        \"<%= Date.today %>\"\n                      }\n                    }\n                  },\n
        \                 {\n                    \"missing\": {\n                      \"field\":
        \"validity_end_date\",\n                      \"null_value\": true,\n                      \"existence\":
        true\n                    }\n                  }\n                ]\n              }\n
        \           ]\n          }\n        ]\n      }\n    }\n  }\n}"
    headers:
      Accept:
      - ! '*/*; q=0.5, application/xml'
      Accept-Encoding:
      - gzip, deflate
      Content-Length:
      - '1178'
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Content-Type:
      - application/json; charset=UTF-8
      Content-Length:
      - '2107'
    body:
      encoding: US-ASCII
      string: ! '{"took":71,"timed_out":false,"_shards":{"total":5,"successful":5,"failed":0},"hits":{"total":3,"max_score":1.0,"hits":[{"_index":"headings","_type":"heading","_id":"28044","_score":1.0,
        "_source" : {"id":28044,"goods_nomenclature_item_id":"0206000000","producline_suffix":"80","validity_start_date":"1972-01-01T00:00:00+03:00","validity_end_date":null,"description":"Edible
        offal of bovine animals, swine, sheep, goats, horses, asses, mules or hinnies,
        fresh, chilled or frozen","number_indents":0,"section":{"numeral":"I","title":"Live
        animals; animal products (chapters 1 to 5)","position":1},"chapter":{"goods_nomenclature_sid":27809,"goods_nomenclature_item_id":"0200000000","producline_suffix":"80","validity_start_date":"1971-12-31T00:00:00+03:00","validity_end_date":null,"description":"meat
        and edible meat offal"}}},{"_index":"headings","_type":"heading","_id":"27624","_score":1.0,
        "_source" : {"id":27624,"goods_nomenclature_item_id":"0101000000","producline_suffix":"80","validity_start_date":"1972-01-01T00:00:00+03:00","validity_end_date":null,"description":"Live
        horses, asses, mules and hinnies","number_indents":0,"section":{"numeral":"I","title":"Live
        animals; animal products (chapters 1 to 5)","position":1},"chapter":{"goods_nomenclature_sid":27623,"goods_nomenclature_item_id":"0100000000","producline_suffix":"80","validity_start_date":"1971-12-31T00:00:00+03:00","validity_end_date":null,"description":"live
        animals"}}},{"_index":"headings","_type":"heading","_id":"28039","_score":1.0,
        "_source" : {"id":28039,"goods_nomenclature_item_id":"0205000000","producline_suffix":"80","validity_start_date":"1972-01-01T00:00:00+03:00","validity_end_date":null,"description":"Meat
        of horses, asses, mules or hinnies, fresh, chilled or frozen","number_indents":0,"section":{"numeral":"I","title":"Live
        animals; animal products (chapters 1 to 5)","position":1},"chapter":{"goods_nomenclature_sid":27809,"goods_nomenclature_item_id":"0200000000","producline_suffix":"80","validity_start_date":"1971-12-31T00:00:00+03:00","validity_end_date":null,"description":"meat
        and edible meat offal"}}}]}}'
    http_version:
  recorded_at: Thu, 27 Jun 2013 13:20:06 GMT
- request:
    method: get
    uri: http://localhost:9200/commodities/_search?size=1000000
    body:
      encoding: UTF-8
      string: ! "{\n  \"query\": {\n    \"constant_score\": {\n      \"filter\": {\n
        \       \"and\": [\n          {\n            \"query\": {\n              \"query_string\":
        {\n                \"query\": \"horse\",\n                \"fields\": [\n
        \                 \"description\"\n                ]\n              }\n            }\n
        \         },\n          {\n            \"or\": [\n              {\n                \"and\":
        [\n                  {\n                    \"range\": {\n                      \"validity_end_date\":
        {\n                        \"gte\": \"<%= Date.today %>\"\n                      }\n
        \                   }\n                  }\n                ]\n              },\n
        \             {\n                \"and\": [\n                  {\n                    \"range\":
        {\n                      \"validity_start_date\": {\n                        \"lte\":
        \"<%= Date.today %>\"\n                      }\n                    }\n                  },\n
        \                 {\n                    \"missing\": {\n                      \"field\":
        \"validity_end_date\",\n                      \"null_value\": true,\n                      \"existence\":
        true\n                    }\n                  }\n                ]\n              }\n
        \           ]\n          }\n        ]\n      }\n    }\n  }\n}"
    headers:
      Accept:
      - ! '*/*; q=0.5, application/xml'
      Accept-Encoding:
      - gzip, deflate
      Content-Length:
      - '1178'
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Content-Type:
      - application/json; charset=UTF-8
      Content-Length:
      - '16902'
    body:
      encoding: US-ASCII
      string: ! '{"took":286,"timed_out":false,"_shards":{"total":5,"successful":5,"failed":0},"hits":{"total":16,"max_score":1.0,"hits":[{"_index":"commodities","_type":"commodity","_id":"74274","_score":1.0,
        "_source" : {"id":74274,"goods_nomenclature_item_id":"2308004000","producline_suffix":"80","validity_start_date":"2002-01-01T00:00:00+02:00","validity_end_date":null,"description":"Acorns
        and horse-chestnuts; pomace or marc of fruit, other than grapes","number_indents":1,"section":{"numeral":"IV","title":"Prepared
        foodstuffs; beverages, spirits and vinegar; tobacco and manufactured tobacco
        substitutes (chapters 16 to 24)","position":4},"chapter":{"goods_nomenclature_sid":35125,"goods_nomenclature_item_id":"2300000000","producline_suffix":"80","validity_start_date":"1971-12-31T00:00:00+03:00","validity_end_date":null,"description":"residues
        and waste from the food industries; prepared animal fodder"},"heading":{"goods_nomenclature_sid":35179,"goods_nomenclature_item_id":"2308000000","producline_suffix":"80","validity_start_date":"1972-01-01T00:00:00+03:00","validity_end_date":null,"description":"Vegetable
        materials and vegetable waste, vegetable residues and by-products, whether
        or not in the form of pellets, of a kind used in animal feeding, not elsewhere
        specified or included","number_indents":0}}},{"_index":"commodities","_type":"commodity","_id":"95674","_score":1.0,
        "_source" : {"id":95674,"goods_nomenclature_item_id":"0302459010","producline_suffix":"80","validity_start_date":"2012-01-01T00:00:00+02:00","validity_end_date":null,"description":"Horse
        mackerel (scad) (Caranx trachurus)","number_indents":4,"section":{"numeral":"I","title":"Live
        animals; animal products (chapters 1 to 5)","position":1},"chapter":{"goods_nomenclature_sid":28373,"goods_nomenclature_item_id":"0300000000","producline_suffix":"80","validity_start_date":"1971-12-31T00:00:00+03:00","validity_end_date":null,"description":"fish
        and crustaceans, molluscs and other aquatic invertebrates"},"heading":{"goods_nomenclature_sid":28402,"goods_nomenclature_item_id":"0302000000","producline_suffix":"80","validity_start_date":"1972-01-01T00:00:00+03:00","validity_end_date":null,"description":"Fish,
        fresh or chilled, excluding fish fillets and other fish meat of heading|0304","number_indents":0}}},{"_index":"commodities","_type":"commodity","_id":"94153","_score":1.0,
        "_source" : {"id":94153,"goods_nomenclature_item_id":"0303510000","producline_suffix":"10","validity_start_date":"2012-01-01T00:00:00+02:00","validity_end_date":null,"description":"Herring
        (Clupea harengus, Clupea pallasii), sardines (Sardina pilchardus, Sardinops|spp.),
        sardinella (Sardinella|spp.), brisling or sprats (Sprattus sprattus), mackerel
        (Scomber scombrus, Scomber australasicus, Scomber japonicus), jack and horse
        mackerel (Trachurus|spp.), cobia (Rachycentron canadum) and swordfish (Xiphias
        gladius), excluding livers and roes","number_indents":1,"section":{"numeral":"I","title":"Live
        animals; animal products (chapters 1 to 5)","position":1},"chapter":{"goods_nomenclature_sid":28373,"goods_nomenclature_item_id":"0300000000","producline_suffix":"80","validity_start_date":"1971-12-31T00:00:00+03:00","validity_end_date":null,"description":"fish
        and crustaceans, molluscs and other aquatic invertebrates"},"heading":{"goods_nomenclature_sid":28590,"goods_nomenclature_item_id":"0303000000","producline_suffix":"80","validity_start_date":"1972-01-01T00:00:00+03:00","validity_end_date":null,"description":"Fish,
        frozen, excluding fish fillets and other fish meat of heading|0304","number_indents":0}}},{"_index":"commodities","_type":"commodity","_id":"94180","_score":1.0,
        "_source" : {"id":94180,"goods_nomenclature_item_id":"0303550000","producline_suffix":"80","validity_start_date":"2012-01-01T00:00:00+02:00","validity_end_date":null,"description":"Jack
        and horse mackerel (Trachurus spp.)","number_indents":2,"section":{"numeral":"I","title":"Live
        animals; animal products (chapters 1 to 5)","position":1},"chapter":{"goods_nomenclature_sid":28373,"goods_nomenclature_item_id":"0300000000","producline_suffix":"80","validity_start_date":"1971-12-31T00:00:00+03:00","validity_end_date":null,"description":"fish
        and crustaceans, molluscs and other aquatic invertebrates"},"heading":{"goods_nomenclature_sid":28590,"goods_nomenclature_item_id":"0303000000","producline_suffix":"80","validity_start_date":"1972-01-01T00:00:00+03:00","validity_end_date":null,"description":"Fish,
        frozen, excluding fish fillets and other fish meat of heading|0304","number_indents":0}}},{"_index":"commodities","_type":"commodity","_id":"72799","_score":1.0,
        "_source" : {"id":72799,"goods_nomenclature_item_id":"0210991000","producline_suffix":"80","validity_start_date":"2002-01-01T00:00:00+02:00","validity_end_date":null,"description":"Of
        horses, salted, in brine or dried","number_indents":4,"section":{"numeral":"I","title":"Live
        animals; animal products (chapters 1 to 5)","position":1},"chapter":{"goods_nomenclature_sid":27809,"goods_nomenclature_item_id":"0200000000","producline_suffix":"80","validity_start_date":"1971-12-31T00:00:00+03:00","validity_end_date":null,"description":"meat
        and edible meat offal"},"heading":{"goods_nomenclature_sid":28295,"goods_nomenclature_item_id":"0210000000","producline_suffix":"80","validity_start_date":"1972-01-01T00:00:00+03:00","validity_end_date":null,"description":"Meat
        and edible meat offal, salted, in brine, dried or smoked; edible flours and
        meals of meat or meat offal","number_indents":0}}},{"_index":"commodities","_type":"commodity","_id":"93985","_score":1.0,
        "_source" : {"id":93985,"goods_nomenclature_item_id":"0302410000","producline_suffix":"10","validity_start_date":"2012-01-01T00:00:00+02:00","validity_end_date":null,"description":"Herring
        (Clupea harengus, Clupea pallasii), anchovies (Engraulis spp.), sardines (Sardina
        pilchardus, Sardinops spp.), sardinella (Sardinella spp.), brisling or sprats
        (Sprattus sprattus), mackerel (Scomber scombrus, Scomber australasicus, Scomber
        japonicus), jack and horse mackerel (Trachurus spp.), cobia (Rachycentron
        canadum) and swordfish (Xiphias gladius), excluding livers and roes","number_indents":1,"section":{"numeral":"I","title":"Live
        animals; animal products (chapters 1 to 5)","position":1},"chapter":{"goods_nomenclature_sid":28373,"goods_nomenclature_item_id":"0300000000","producline_suffix":"80","validity_start_date":"1971-12-31T00:00:00+03:00","validity_end_date":null,"description":"fish
        and crustaceans, molluscs and other aquatic invertebrates"},"heading":{"goods_nomenclature_sid":28402,"goods_nomenclature_item_id":"0302000000","producline_suffix":"80","validity_start_date":"1972-01-01T00:00:00+03:00","validity_end_date":null,"description":"Fish,
        fresh or chilled, excluding fish fillets and other fish meat of heading|0304","number_indents":0}}},{"_index":"commodities","_type":"commodity","_id":"94181","_score":1.0,
        "_source" : {"id":94181,"goods_nomenclature_item_id":"0303551000","producline_suffix":"80","validity_start_date":"2012-01-01T00:00:00+02:00","validity_end_date":null,"description":"Atlantic
        horse mackerel (Trachurus trachurus)","number_indents":3,"section":{"numeral":"I","title":"Live
        animals; animal products (chapters 1 to 5)","position":1},"chapter":{"goods_nomenclature_sid":28373,"goods_nomenclature_item_id":"0300000000","producline_suffix":"80","validity_start_date":"1971-12-31T00:00:00+03:00","validity_end_date":null,"description":"fish
        and crustaceans, molluscs and other aquatic invertebrates"},"heading":{"goods_nomenclature_sid":28590,"goods_nomenclature_item_id":"0303000000","producline_suffix":"80","validity_start_date":"1972-01-01T00:00:00+03:00","validity_end_date":null,"description":"Fish,
        frozen, excluding fish fillets and other fish meat of heading|0304","number_indents":0}}},{"_index":"commodities","_type":"commodity","_id":"93993","_score":1.0,
        "_source" : {"id":93993,"goods_nomenclature_item_id":"0302450000","producline_suffix":"80","validity_start_date":"2012-01-01T00:00:00+02:00","validity_end_date":null,"description":"Jack
        and horse mackerel (Trachurus spp.)","number_indents":2,"section":{"numeral":"I","title":"Live
        animals; animal products (chapters 1 to 5)","position":1},"chapter":{"goods_nomenclature_sid":28373,"goods_nomenclature_item_id":"0300000000","producline_suffix":"80","validity_start_date":"1971-12-31T00:00:00+03:00","validity_end_date":null,"description":"fish
        and crustaceans, molluscs and other aquatic invertebrates"},"heading":{"goods_nomenclature_sid":28402,"goods_nomenclature_item_id":"0302000000","producline_suffix":"80","validity_start_date":"1972-01-01T00:00:00+03:00","validity_end_date":null,"description":"Fish,
        fresh or chilled, excluding fish fillets and other fish meat of heading|0304","number_indents":0}}},{"_index":"commodities","_type":"commodity","_id":"91682","_score":1.0,
        "_source" : {"id":91682,"goods_nomenclature_item_id":"4412321000","producline_suffix":"80","validity_start_date":"2010-01-01T00:00:00+02:00","validity_end_date":null,"description":"Of
        alder, ash, beech, birch, cherry, chestnut, elm, hickory, hornbeam, horse
        chestnut, lime, maple, oak, plane tree, poplar, robinia, walnut or yellow
        poplar","number_indents":3,"section":{"numeral":"IX","title":"Wood and articles
        of wood; wood charcoal; cork and articles of cork; manufactures of straw,
        of esparto or of other plaiting materials; basket-ware and wickerwork (chapters
        44 to 46)","position":9},"chapter":{"goods_nomenclature_sid":39988,"goods_nomenclature_item_id":"4400000000","producline_suffix":"80","validity_start_date":"1971-12-31T00:00:00+03:00","validity_end_date":null,"description":"wood
        and articles of wood; wood charcoal"},"heading":{"goods_nomenclature_sid":40191,"goods_nomenclature_item_id":"4412000000","producline_suffix":"80","validity_start_date":"1972-01-01T00:00:00+03:00","validity_end_date":null,"description":"Plywood,
        veneered panels and similar laminated wood","number_indents":0}}},{"_index":"commodities","_type":"commodity","_id":"91687","_score":1.0,
        "_source" : {"id":91687,"goods_nomenclature_item_id":"4412994000","producline_suffix":"80","validity_start_date":"2010-01-01T00:00:00+02:00","validity_end_date":null,"description":"Of
        alder, ash, beech, birch, cherry, chestnut, elm, hickory, hornbeam, horse
        chestnut, lime, maple, oak, plane tree, poplar, robinia, walnut or yellow
        poplar","number_indents":5,"section":{"numeral":"IX","title":"Wood and articles
        of wood; wood charcoal; cork and articles of cork; manufactures of straw,
        of esparto or of other plaiting materials; basket-ware and wickerwork (chapters
        44 to 46)","position":9},"chapter":{"goods_nomenclature_sid":39988,"goods_nomenclature_item_id":"4400000000","producline_suffix":"80","validity_start_date":"1971-12-31T00:00:00+03:00","validity_end_date":null,"description":"wood
        and articles of wood; wood charcoal"},"heading":{"goods_nomenclature_sid":40191,"goods_nomenclature_item_id":"4412000000","producline_suffix":"80","validity_start_date":"1972-01-01T00:00:00+03:00","validity_end_date":null,"description":"Plywood,
        veneered panels and similar laminated wood","number_indents":0}}},{"_index":"commodities","_type":"commodity","_id":"93994","_score":1.0,
        "_source" : {"id":93994,"goods_nomenclature_item_id":"0302451000","producline_suffix":"80","validity_start_date":"2012-01-01T00:00:00+02:00","validity_end_date":null,"description":"Atlantic
        horse mackerel (Trachurus trachurus)","number_indents":3,"section":{"numeral":"I","title":"Live
        animals; animal products (chapters 1 to 5)","position":1},"chapter":{"goods_nomenclature_sid":28373,"goods_nomenclature_item_id":"0300000000","producline_suffix":"80","validity_start_date":"1971-12-31T00:00:00+03:00","validity_end_date":null,"description":"fish
        and crustaceans, molluscs and other aquatic invertebrates"},"heading":{"goods_nomenclature_sid":28402,"goods_nomenclature_item_id":"0302000000","producline_suffix":"80","validity_start_date":"1972-01-01T00:00:00+03:00","validity_end_date":null,"description":"Fish,
        fresh or chilled, excluding fish fillets and other fish meat of heading|0304","number_indents":0}}},{"_index":"commodities","_type":"commodity","_id":"96208","_score":1.0,
        "_source" : {"id":96208,"goods_nomenclature_item_id":"0303559010","producline_suffix":"80","validity_start_date":"2012-01-01T00:00:00+02:00","validity_end_date":null,"description":"Horse
        mackerel (scad) (Caranx trachurus)","number_indents":4,"section":{"numeral":"I","title":"Live
        animals; animal products (chapters 1 to 5)","position":1},"chapter":{"goods_nomenclature_sid":28373,"goods_nomenclature_item_id":"0300000000","producline_suffix":"80","validity_start_date":"1971-12-31T00:00:00+03:00","validity_end_date":null,"description":"fish
        and crustaceans, molluscs and other aquatic invertebrates"},"heading":{"goods_nomenclature_sid":28590,"goods_nomenclature_item_id":"0303000000","producline_suffix":"80","validity_start_date":"1972-01-01T00:00:00+03:00","validity_end_date":null,"description":"Fish,
        frozen, excluding fish fillets and other fish meat of heading|0304","number_indents":0}}},{"_index":"commodities","_type":"commodity","_id":"93797","_score":1.0,
        "_source" : {"id":93797,"goods_nomenclature_item_id":"0101210000","producline_suffix":"10","validity_start_date":"2012-01-01T00:00:00+02:00","validity_end_date":null,"description":"Horses","number_indents":1,"section":{"numeral":"I","title":"Live
        animals; animal products (chapters 1 to 5)","position":1},"chapter":{"goods_nomenclature_sid":27623,"goods_nomenclature_item_id":"0100000000","producline_suffix":"80","validity_start_date":"1971-12-31T00:00:00+03:00","validity_end_date":null,"description":"live
        animals"},"heading":{"goods_nomenclature_sid":27624,"goods_nomenclature_item_id":"0101000000","producline_suffix":"80","validity_start_date":"1972-01-01T00:00:00+03:00","validity_end_date":null,"description":"Live
        horses, asses, mules and hinnies","number_indents":0}}},{"_index":"commodities","_type":"commodity","_id":"28100","_score":1.0,
        "_source" : {"id":28100,"goods_nomenclature_item_id":"0206809100","producline_suffix":"80","validity_start_date":"1972-01-01T00:00:00+03:00","validity_end_date":null,"description":"Of
        horses, asses, mules and hinnies","number_indents":3,"section":{"numeral":"I","title":"Live
        animals; animal products (chapters 1 to 5)","position":1},"chapter":{"goods_nomenclature_sid":27809,"goods_nomenclature_item_id":"0200000000","producline_suffix":"80","validity_start_date":"1971-12-31T00:00:00+03:00","validity_end_date":null,"description":"meat
        and edible meat offal"},"heading":{"goods_nomenclature_sid":28044,"goods_nomenclature_item_id":"0206000000","producline_suffix":"80","validity_start_date":"1972-01-01T00:00:00+03:00","validity_end_date":null,"description":"Edible
        offal of bovine animals, swine, sheep, goats, horses, asses, mules or hinnies,
        fresh, chilled or frozen","number_indents":0}}},{"_index":"commodities","_type":"commodity","_id":"28105","_score":1.0,
        "_source" : {"id":28105,"goods_nomenclature_item_id":"0206909100","producline_suffix":"80","validity_start_date":"1972-01-01T00:00:00+03:00","validity_end_date":null,"description":"Of
        horses, asses, mules and hinnies","number_indents":3,"section":{"numeral":"I","title":"Live
        animals; animal products (chapters 1 to 5)","position":1},"chapter":{"goods_nomenclature_sid":27809,"goods_nomenclature_item_id":"0200000000","producline_suffix":"80","validity_start_date":"1971-12-31T00:00:00+03:00","validity_end_date":null,"description":"meat
        and edible meat offal"},"heading":{"goods_nomenclature_sid":28044,"goods_nomenclature_item_id":"0206000000","producline_suffix":"80","validity_start_date":"1972-01-01T00:00:00+03:00","validity_end_date":null,"description":"Edible
        offal of bovine animals, swine, sheep, goats, horses, asses, mules or hinnies,
        fresh, chilled or frozen","number_indents":0}}},{"_index":"commodities","_type":"commodity","_id":"30763","_score":1.0,
        "_source" : {"id":30763,"goods_nomenclature_item_id":"0713500000","producline_suffix":"80","validity_start_date":"1972-01-01T00:00:00+03:00","validity_end_date":null,"description":"Broad
        beans (Vicia faba var. major) and horse beans (Vicia faba var. equina, Vicia
        faba var. minor)","number_indents":1,"section":{"numeral":"II","title":"Vegetable
        products (chapters 6 to 14)","position":2},"chapter":{"goods_nomenclature_sid":30240,"goods_nomenclature_item_id":"0700000000","producline_suffix":"80","validity_start_date":"1971-12-31T00:00:00+03:00","validity_end_date":null,"description":"edible
        vegetables and certain roots and tubers"},"heading":{"goods_nomenclature_sid":30726,"goods_nomenclature_item_id":"0713000000","producline_suffix":"80","validity_start_date":"1972-01-01T00:00:00+03:00","validity_end_date":null,"description":"Dried
        leguminous vegetables, shelled, whether or not skinned or split","number_indents":0}}}]}}'
    http_version:
  recorded_at: Thu, 27 Jun 2013 13:20:06 GMT
- request:
    method: get
    uri: http://localhost:9200/search_references/_search?size=1000000
    body:
      encoding: UTF-8
      string: ! "{\n  \"query\": {\n    \"filtered\": {\n      \"query\": {\n        \"query_string\":
        {\n          \"fields\": [\n            \"title\"\n          ],\n          \"analyzer\":
        \"snowball\",\n          \"query\": \"horse\"\n        }\n      },\n      \"filter\":
        {\n        \"nested\": {\n          \"path\": \"reference\",\n          \"query\":
        {\n            \"filtered\": {\n              \"query\": {\n                \"match_all\":
        {\n\n                }\n              },\n              \"filter\": {\n                \"or\":
        [\n                  {\n                    \"and\": [\n                      {\n
        \                       \"range\": {\n                          \"reference.validity_end_date\":
        {\n                            \"gte\": \"<%= Date.today %>\"\n                          }\n
        \                       }\n                      }\n                    ]\n
        \                 },\n                  {\n                    \"and\": [\n
        \                     {\n                        \"range\": {\n                          \"reference.validity_start_date\":
        {\n                            \"lte\": \"<%= Date.today %>\"\n                          }\n
        \                       }\n                      },\n                      {\n
        \                       \"missing\": {\n                          \"field\":
        \"reference.validity_end_date\",\n                          \"null_value\":
        true,\n                          \"existence\": true\n                        }\n
        \                     }\n                    ]\n                  },\n                  {\n
        \                   \"and\": [\n                      {\n                        \"missing\":
        {\n                          \"field\": \"reference.validity_start_date\",\n
        \                         \"null_value\": true,\n                          \"existence\":
        true\n                        }\n                      },\n                      {\n
        \                       \"missing\": {\n                          \"field\":
        \"reference.validity_end_date\",\n                          \"null_value\":
        true,\n                          \"existence\": true\n                        }\n
        \                     }\n                    ]\n                  }\n                ]\n
        \             }\n            }\n          }\n        }\n      }\n    }\n  }\n}"
    headers:
      Accept:
      - ! '*/*; q=0.5, application/xml'
      Accept-Encoding:
      - gzip, deflate
      Content-Length:
      - '2128'
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Content-Type:
      - application/json; charset=UTF-8
      Content-Length:
      - '122'
    body:
      encoding: US-ASCII
      string: ! '{"took":1,"timed_out":false,"_shards":{"total":5,"successful":5,"failed":0},"hits":{"total":0,"max_score":null,"hits":[]}}'
    http_version:
  recorded_at: Thu, 27 Jun 2013 13:20:06 GMT
recorded_with: VCR 2.2.5
